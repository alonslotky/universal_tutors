{% load classes_tags %}

<div id="modal-add-availability" class="reveal-modal message">
	<h4>Availability</h4>
    <div id="modal-add-availability-loading" class="modal-loading"></div>
    <div id="modal-add-availability-container">
	  <form id="modal-add-availability-form" class="nice">
	  	{% csrf_token %}
		<div class="row">&nbsp;</div>
		<div id="add-availability-errors" class="formError"></div>
		<div class="row">
		  <div class="four columns phone-one">        
		    <label>Weekday</label>
		  </div>
		  <div class="eight columns phone-three">
			<select id="add-availability-weekday" name="weekday" class="stretch">
				<option value="-1">--------</option>
				<option value="0">Monday</option>
				<option value="1">Tuesday</option>
				<option value="2">Wednesday</option>
				<option value="3">Thursday</option>
				<option value="4">Friday</option>
				<option value="5">Saturday</option>
				<option value="6">Sunday</option>
			</select>
		  </div>	  
		</div>
		<div class="row">
		  <div class="four columns phone-one">        
		    <label>From</label>
		  </div>
		  <div class="eight columns phone-three">
		  	<div class="six columns phone-two">
			  	<select id="add-availability-from-hour" name="from-hour" class="stretch">
			  		<option value="-1">--</option>
			  		<option value="0">00h</option>
			  		<option value="1">01h</option>
			  		<option value="2">02h</option>
			  		<option value="3">03h</option>
			  		<option value="4">04h</option>
			  		<option value="5">05h</option>
			  		<option value="6">06h</option>
			  		<option value="7">07h</option>
			  		<option value="8">08h</option>
			  		<option value="9">09h</option>
			  		<option value="10">10h</option>
			  		<option value="11">11h</option>
			  		<option value="12">12h</option>
			  		<option value="13">13h</option>
			  		<option value="14">14h</option>
			  		<option value="15">15h</option>
			  		<option value="16">16h</option>
			  		<option value="17">17h</option>
			  		<option value="18">18h</option>
			  		<option value="19">19h</option>
			  		<option value="20">20h</option>
			  		<option value="21">21h</option>
			  		<option value="22">22h</option>
			  		<option value="23">23h</option>
			  	</select>
		  	</div>
		  	<div class="six columns phone-two">
			  	<select id="add-availability-from-minute" name="from-minute" class="stretch">
			  		<option value="-1">--</option>
			  		<option value="0">00m</option>
			  		<option value="15">15m</option>
			  		<option value="30">30m</option>
			  		<option value="45">45m</option>
			  	</select>
		  	</div>
		  </div>	  
		</div>
		<div class="row">
		  <div class="four columns phone-one">        
		    <label>To</label>
		  </div>
		  <div class="eight columns phone-three">
		  	<div class="six columns phone-two">
			  	<select id="add-availability-to-hour" name="to-hour" class="stretch">
			  		<option value="-1">--</option>
			  		<option value="0">00h</option>
			  		<option value="1">01h</option>
			  		<option value="2">02h</option>
			  		<option value="3">03h</option>
			  		<option value="4">04h</option>
			  		<option value="5">05h</option>
			  		<option value="6">06h</option>
			  		<option value="7">07h</option>
			  		<option value="8">08h</option>
			  		<option value="9">09h</option>
			  		<option value="10">10h</option>
			  		<option value="11">11h</option>
			  		<option value="12">12h</option>
			  		<option value="13">13h</option>
			  		<option value="14">14h</option>
			  		<option value="15">15h</option>
			  		<option value="16">16h</option>
			  		<option value="17">17h</option>
			  		<option value="18">18h</option>
			  		<option value="19">19h</option>
			  		<option value="20">20h</option>
			  		<option value="21">21h</option>
			  		<option value="22">22h</option>
			  		<option value="23">23h</option>
			  	</select>
		  	</div>
		  	<div class="six columns phone-two">
			  	<select id="add-availability-to-minute" name="to-minute" class="stretch">
			  		<option value="-1">--</option>
			  		<option value="0">00m</option>
			  		<option value="15">15m</option>
			  		<option value="30">30m</option>
			  		<option value="45">45m</option>
			  	</select>		  		
		  	</div>
		  </div>	  
		</div>
		<div class="row">&nbsp;</div>
	  	<div class="row">
		    <input type="submit" class="small button" value="Add availability">
		</div>
	  </form>
      	
    </div>
  	<a class="close-reveal-modal">&#215;</a>
</div>

<script type="text/javascript">
	$('#modal-add-availability-loading').hide();
	
	$('#modal-add-availability-form').submit(function(e){
		e.preventDefault();
		
		var weekday = parseInt($('#add-availability-weekday').val());
		var from_hour = parseInt($('#add-availability-from-hour').val());
		var from_minute = parseInt($('#add-availability-from-minute').val());
		var to_hour = parseInt($('#add-availability-to-hour').val());
		var to_minute = parseInt($('#add-availability-to-minute').val());
		
		if(!(weekday>=0 && from_hour>=0 && from_minute>=0 && to_hour>=0 && to_minute>=0)) {
			$('#add-availability-errors').html('Please fill all the fields below');
			$('#add-availability-errors').removeClass('hidden');
			return false;
		}
		
		if( (to_hour<from_hour || (to_hour==from_hour && to_minute <= from_minute)) && !(to_hour==0 && to_minute==0) ) {
			$('#add-availability-errors').html('"From" value must be higher than "To".');
			$('#add-availability-errors').removeClass('hidden');
			return false;			
		}
		
		var begin = from_hour +'-'+ from_minute;
		var end = to_hour +'-'+ to_minute;
		
		$('#modal-add-availability-container').fadeOut(function(){
			$('#modal-add-availability-loading').fadeIn(function(){
				$.ajax({
					type: 'post',
					url: '{% url user_edit_week_period %}0/'+ begin +'/'+ end +'/'+ weekday +'/',
					data: $('#modal-add-availability-form').serialize(),
					success: function(response) {
						window.location.reload();			
					},
					error: function(){
						$('#add-availability-errors').html('It is not possible to create availability for between '+ from_hour +':'+ from_minute +' and '+ to_hour +':'+ to_minute +'.');
						$('#add-availability-errors').removeClass('hidden');
						
						$('#modal-add-availability-loading').fadeOut(function(){
							$('#modal-add-availability-container').fadeIn();
						});
					}
				});
			});
		});
		$('#id_credits_errors').removeClass('hidden');
	});
	
	var add_availability_clear = function(weekday){
		$('select').val('-1');
		$('#add-availability-weekday').val((!isNaN(weekday))?weekday:'');
		$('#add-availability-errors').html('');
		$('#add-availability-errors').addClass('hidden');
	}
</script>